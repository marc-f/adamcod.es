<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">

    
        <title>How to Create a Git Plugin - adamcod.es</title>
    

    

    <meta name="author" content="Adam Brett">

    <!-- style -->
    <link rel="stylesheet" href="/css/style.css" type="text/css" media="screen, projection">

    <!-- RSS -->
    <link rel="alternate" type="application/rss+xml" href="http://feeds.feedburner.com/adamcodes/">

    <!-- fonts -->
    <link href="http://fonts.googleapis.com/css?family=Open+Sans:300,400" rel="stylesheet" type="text/css">
</head>
<body>
    <section class="layout-meta">
        <header>
            <p class="author vcard">
                <strong><a href="http://adamcod.es" rel="author">adamcod.es</a></strong><br />
                by <a href="http://adambrett.co.uk">Adam Brett</a>
            </p>
        </header>

        <nav>
            <ul>
                <!--li><a href="http://adambrett.co.uk/about">About</a></li-->
                <li><a href="/archive.html"><i class="icon-book"></i> Archive</a></li>
                <li><a href="http://feeds.feedburner.com/adamcodes/"><i class="icon-rss"></i> Subscribe</a></li>
                <li><a href="http://twitter.com/sixdaysad/"><i class="icon-twitter"></i> Contact</a></li>
            </ul>
        </nav>
    </section>

    <section class="layout-main">
        <article>
    <div class="instapaper_ignore entry-unrelated">

    <h1 class="entry-title"><a href="http://adamcod.es/2013/07/12/how-to-create-git-plugin.html">How to Create a Git Plugin</a></h1>
    <p class="meta"><time pubdate class="published" datetime="2013-07-12">Friday, July 12, 2013</time></p>
    <div class="twitter-button">
        
        <a href="https://twitter.com/share" class="twitter-share-button" data-url="http://adamcod.es/2013/07/12/how-to-create-git-plugin.html" data-text="How to Create a Git Plugin by @sixdaysad">Tweet</a>
        
    </div>

    


    </div>

    <div class="entry-content">
        <p>I think most Git users know by now how to create an alias in Git to make a function or command more accessible.  What I think fewer people know, or at least don’t take advantage of, is that you can actually create extensions or plugins to Git to make it do basically anything you want.</p>

<p>What I think even fewer people realise is actually how amazingly easy it is to create one of these extensions.</p>

<!-- more -->

<h2 id="what-you-need-to-know-the-essentials">What You Need to Know (The Essentials)</h2>

<ol>
  <li>Create a shell or bash script that does what you want to do</li>
  <li>Name your shell script git-<em>name</em> where <em>name</em> is the command you want to run after typing <code>git</code>.</li>
  <li>Put your script in <code>/usr/local/bin</code> or somewhere similar in your <code>$PATH</code></li>
  <li>Run your script using <code>git name</code></li>
</ol>

<p>Using this method you can make Git do anything you want.  However, what you might want to consider is grouping a bunch of similar scripts together into a module of sorts, much like the Git flow plugin<sup id="fnref:1"><a href="#fn:1" class="footnote">1</a></sup>.  This would allow you to run your command namespaced, so you could have (for example): <code>git yourname subcommand</code> or <code>git mycompany deploy</code>.</p>

<h2 id="more-advanced-usage">More Advanced Usage</h2>

<p>Here’s the basic concept:</p>

<ol>
  <li>Create a “wrapper” or access point for your plugin</li>
  <li>Create a file/script for each sub-command you want to run</li>
  <li>Use your wrapper to load and run your sub-command scripts</li>
</ol>

<h3 id="defining-some-requirements">Defining Some Requirements</h3>

<p>For the sake of simplicity, I’m going to call our namespace “adamcodes” and our plugin is going to do three things:</p>

<ol>
  <li>Report its version with the <code>-v</code> or <code>--version</code> flags</li>
  <li>Display usage information if the subcommand is missing, or the <code>-h</code> or <code>--help</code> flags are used</li>
  <li>Print <code>Hello {name}|World</code> when we use the <code>hello</code> subcommand, printing out <code>Hello {name}</code> if any further options are passed, or <code>Hello World</code> if not.</li>
</ol>

<h3 id="getting-started">Getting Started</h3>

<p>First, let’s create a directory to work in: <code>mkdir -p ~/src/adamcodes-git-plugin &amp;&amp; cd ~/src/adamcodes-git-plugin</code>.</p>

<p>Now we need to create our wrapper file.  This is the file that will run all of our commands, it will actually be the only executable file in our plugin.</p>

<p>This file needs to be named in the following format, this is essential or Git won’t be able to find it.</p>

<p><code>touch git-adamcodes</code></p>

<p>That’s it.  It has to start with <code>git-</code> and then the bit that follows is the command you’ll use to run it.</p>

<p>Now let’s edit that file and add some stuff.  The first line of every executable script is the hashbang or shebang.  This is so the operating system knows what to use to run your script.</p>

<p>You could use PHP, Ruby, Python or whatever here and Git should just run it as normal.  I haven’t tested that though, so I’m going to stick to using bash.</p>

<h3 id="main-script-wrapperrunner">Main Script (Wrapper/Runner)</h3>

<p>A hashbang looks like this:</p>

<pre><code>#!/bin/sh</code></pre>

<p>Now most people will have a compatible shell available in that location, but we can make it a bit more portable by checking the users’ ENV for the location of their shell, just in-case:</p>

<pre><code>#!/usr/bin/env sh</code></pre>

<p>Next, we need a couple of help functions.  These should be fairly self explanatory, they just print words to the screen.  The first is going to print out our version number:</p>

<pre><code>version() {
    echo &quot;adamcodes git plugin v0.1.0&quot;
    echo
}</code></pre>

<p>And the next is going to print our usage information:</p>

<pre><code>usage() {
    echo &quot;usage: git adamcodes &lt;subcommand&gt;&quot;
    echo
    echo &quot;Available subcommands are:&quot;
    echo &quot;hello &lt;name&gt;  Print out Hello World or Hello &lt;name&gt; (if provided)&quot;
}</code></pre>

<p>Next, we get into the main part.  Tradition dictates that the main execution of a bash script takes place in the <code>main</code> function, so that’s what we’ll call ours, too:</p>

<pre><code>main() {
    if [ &quot;$#&quot; -lt 1 ]; then
        usage; exit 1
    fi

    local subcommand=&quot;$1&quot;; shift

    case $subcommand in
        &quot;-h&quot;|&quot;--help&quot;)
            usage; exit 0
            ;;
        &quot;-v&quot;|&quot;--version&quot;)
            version; exit 0
            ;;
    esac

    export WORKINGDIR=$(dirname &quot;$(echo &quot;$0&quot; | sed -e &#39;s,\\,/,g&#39;)&quot;)
    if [ ! -e &quot;$WORKINGDIR/git-adamcodes-$subcommand&quot; ]; then
        usage; exit 1
    fi

    source &quot;$WORKINGDIR/git-adamcodes-$subcommand&quot;

    if [ ! type &quot;cmd_$subcommand&quot; ]; then
        usage; exit 1
    fi

    cmd_$subcommand &quot;$@&quot;
}</code></pre>

<p>Okay, if you’re not used to shell scripting this will probably look a bit scary.  Let’s break it down piece-by-piece.</p>

<pre><code>if [ &quot;$#&quot; -lt 1 ]; then
    usage; exit 1
fi</code></pre>

<p>This first line is fairly simple.  When you pass an argument to a shell script it gets passed in in numbered variables $0 to $N.  Each space is treated as a new variable, with $0 containing the name of the script you ran.  <code>if [ "$#" -lt 1 ]</code> is basically saying “if the number of options is less than one”.</p>

<p>As we’re always expecting a subcommand, we can assume if the number of options is less than 1 we have an error, and should display our usage information.  That’s what the next line does <code>usage</code> simply runs the <code>usage</code> function we defined above.</p>

<p><code>exit 1</code> is all about reporting back to Git (and the shell) whether a command ran successfully or not.  <code>exit</code> will kill the execution of a script, just like in PHP, and a successful exit means exiting with <code>0</code>.  An exit in the range <code>1-255</code> is considered an error and can be used to map to error messages if you have a manual or whatever.  We don’t, so we’ll just exit with 1 to let the shell know it didn’t run successfully, as we expected more parameters.</p>

<pre><code>local subcommand=&quot;$1&quot;; shift</code></pre>

<p>The next line does two things again.  You can do more than one thing per line in bash by separating with a semi-colon.  If you put them one per line you don’t need the semi-colon.  First, we define a local variable called <code>subcommand</code>, hence, the <code>local</code>, and then we’re assigning the first parameter passed to our script into that variable.</p>

<p>The <code>shift</code> function moves the numbers for passed variables along the number of spaces passed to it.  That is to say, if we called our script like so:</p>

<pre><code>./script.sh hello world this is a test
</code></pre>

<p>We would end up with the following:</p>

<pre><code>$0: ./script.sh
$1: hello
$2: world
$3: this
$4: is
$5: a
$6: test
</code></pre>

<p>If we called <code>shift</code> without any number afterwards, it will just move things along one space, so in our example this would leave us with:</p>

<pre><code>$0: ./script.sh
$1: world
$2: this
$3: is
$4: a
$5: test
</code></pre>

<p>If we then called <code>shift</code> but this time passed in the number 2, like so: <code>shift 2</code> we should end up with:</p>

<pre><code>$0: ./script.sh
$1: this
$2: is
$3: a
$4: test
</code></pre>

<p>You’ll notice the script name always remains in <code>$0</code>, this is important for later.</p>

<pre><code>case $subcommand in
    &quot;-h&quot;|&quot;--help&quot;)
        usage; exit 0
        ;;
    &quot;-v&quot;|&quot;--version&quot;)
        version; exit 0
        ;;
esac</code></pre>

<p>Next we use a standard case statement to check whether the subcommand we just set is equal to <code>-h</code>, <code>--help</code>, <code>-v</code> or <code>--version</code>.  As per our spec above, each of these should run a specific function.  If we find a match we simply run the correct function and exit with 0, which means that we ran successfully.  the <code>;;</code> below each set of commands is the equivalent of <code>break</code> in PHP and tells the shell to not continue checking the rest of the case statement.</p>

<pre><code>local workingdir=$(dirname &quot;$(echo &quot;$0&quot; | sed -e &#39;s,\\,/,g&#39;)&quot;)</code></pre>

<p>This next snippet gets our working directory.  We need this so we know where to look for our sub-command files, as they should be in the same directory as the script we’re running.</p>

<p>To do this, we use a couple of bash tricks.  First, we create a local variable as we did before.  We then use <code>$(...)</code>, which allows you to execute a command and capture the result into the variable.</p>

<p>The bash function we’re calling is dirname, which like the PHP equivalent takes the name of a file and provides you with the directory name.</p>

<p>As we mentioned earlier, when you run a bash script the script name gets passed into the script in the variable <code>$0</code>, so running <code>$(dirname $0)</code> should give us what we’re after, however, that’s not so great for our windows users (e.g. cygwin), as the path separator will be the wrong way around.  Therefore, we nest another <code>$(...)</code> call where we echo out the value of <code>$0</code>, pipe the output into the <code>sed</code> command, and replace all backslashes with forward slashes.  We then take the output of that (captured by the nested <code>$(...)</code>) and pass it back into dirname, and then assign the captured output of that to the <code>workingdir</code> variable.</p>

<pre><code>if [ ! -e &quot;$WORKINGDIR/git-adamcodes-$subcommand&quot; ]; then
    usage; exit 1
fi</code></pre>

<p>Next, we’re simply checking to see if the file for the subcommand exists.  We’re expecting the files to be in the same directory as our current file, and to be named in the format <code>git-namespace-subcommand</code>.  If we don’t find it, we need to print out our usage info and exit with an error status.  If we do, we can simply carry on.</p>

<pre><code>source &quot;$WORKINGDIR/git-adamcodes-$subcommand&quot;</code></pre>

<p><code>source</code> is a built-in command that will run a file inside the current shell.  That means it will load all functions and variables from that file and they will be available throughout the shell.  Anything that this script executes will also execute, it’s exactly the same as running the file yourself.</p>

<p>This means we can put our sub-commands in their own files, with their own variables, but not run them, just make them accessible when we need them.  Think of this like a PHP <code>include</code>.</p>

<pre><code>if [ ! type &quot;cmd_$subcommand&quot; ]; then
    usage; exit 1
fi</code></pre>

<p>Now we’ve loaded the file, we should have the sub-command function available to execute, so we test to make sure it exists.  If it doesn’t there’s obviously something wrong, so do our standard “print usage information and error exit status” step.  This actually produces some output we have to do something about, so we do some bash trickery and redirect it into <code>/dev/null</code>, which is basically a black hole for anything you don’t want.</p>

<pre><code>cmd_$subcommand &quot;$@&quot;</code></pre>

<p>Finally we get down to it.  This step runs our sub-command and passes in our <code>$0...$n</code> variables as function parameters.  We expect our sub-command’s main function to be called <code>cmd_subcommand</code> where <em>subcommand</em> is the name of the sub-command you want to type to run it.  If we also called them <code>main</code> we’d end up with a conflict with our existing main function.</p>

<p>The reason we used <code>shift</code> earlier is so that we can write our sub-commands without any knowledge of this wrapper, as far as they’re concerned the variables that get passed in are the same as if they were called directly (without the sub-command name in <code>$1</code>).</p>

<p>Now we’ve built up our <code>main</code> function it won’t run on its own, we need to actually call it and pass in our <code>$0...$n</code> variables.  To do that, we just do the same as above, but call main instead:</p>

<pre><code>main &quot;$@&quot;</code></pre>

<h4 id="pulling-it-all-together">Pulling it all Together</h4>

<p>Finally, bringing it all together our plugin’s main file should look like this:</p>

<pre><code>#!/usr/bin/env sh

usage() {
    echo &quot;usage: git adamcodes &lt;subcommand&gt;&quot;
    echo
    echo &quot;Available subcommands are:&quot;
    echo &quot;hello &lt;name&gt;  Print out Hello World or Hello &lt;name&gt; (if provided)&quot;
}

version() {
    echo &quot;adamcodes git plugin v0.1.0&quot;
    echo
}

main() {
    if [ &quot;$#&quot; -lt 1 ]; then
        usage; exit 1
    fi

    local subcommand=&quot;$1&quot;; shift

    case $subcommand in
        &quot;-h&quot;|&quot;--help&quot;)
            usage; exit 0
            ;;
        &quot;-v&quot;|&quot;--version&quot;)
            version; exit 0
            ;;
    esac

    local workingdir=$(dirname &quot;$(echo &quot;$0&quot; | sed -e &#39;s,\\,/,g&#39;)&quot;)
    if [ ! -e &quot;$workingdir/git-adamcodes-$subcommand&quot; ]; then
        usage; exit 1
    fi

    source &quot;$workingdir/git-adamcodes-$subcommand&quot;

    if [ ! type &quot;cmd_$subcommand&quot; ]; then
        usage; exit 1
    fi

    cmd_$subcommand &quot;$@&quot;
}

main &quot;$@&quot;</code></pre>

<p>In <a href="/2013/07/19/how-to-create-git-plugin-part2.html">part 2</a> I go on to create our hello sub-command, and show you how to write a makefile and use make so installing and removing your add-on becomes really simple.  Make sure you subscribe to my feed so you don’t miss it!</p>

<h2 id="read-next"> Read Next</h2>

<ul>
  <li><a href="/2013/07/19/how-to-create-git-plugin-part2.html">How to Create a Git Plugin (Part 2)</a></li>
</ul>

<div class="footnotes">
  <ol>
    <li id="fn:1">
      <p>https://github.com/nvie/gitflow<a href="#fnref:1" class="reversefootnote">&#8617;</a></p>
    </li>
  </ol>
</div>

    </div>

    <section>
        <form class="well form-inline text-center" action="https://tinyletter.com/adambrett" method="post" target="popupwindow" onsubmit="window.open('https://tinyletter.com/adambrett', 'popupwindow', 'scrollbars=yes,width=800,height=600');return true">
    <p>For more exclusive content, including screen-casts, videos, and early beta access to my projects, subscribe to my email list below.</p>
    <p>
        <input type="text" name="email" placeholder="Enter your email address" /> <input type="submit" value="Subscribe" class="btn btn-primary" />
    </p>

    <input type="hidden" value="1" name="embed"/>
</form>

    </section>

    <hr>

    <footer>
        <p><small>I love discussion, but not blog comments.  If you want to comment on what's written above, head over to <a href="https://twitter.com/sixdaysad">twitter</a> or <a href="https://alpha.app.net/adambrett">ADN</a>.</small></p>
    </footer>
</article>


<hr>

<ul class="pager">
    
    <li class="previous">
        <a href="/2013/07/02/you-cant-trust-the-cloud.html">&larr; Previous</a>
    </li>
    

    
    <li class="next">
        <a href="/2013/07/19/how-to-create-git-plugin-part2.html">Next &rarr;</a>
    </li>
    
</ul>


        <footer>
            <p>Copyright &copy; 2012 <a href="http://adambrett.co.uk">Adam Brett</a>.  All rights reserved.</p>
        </footer>
    </section>

    <script>
        (function () {
            var images = document.getElementsByTagName('img');
            for (var i = 0; i < images.length; i++) {
                images[i].style.height = (Math.floor(images[i].clientHeight/26) * 26) + 'px';
            }
        })();
    </script>
    <script src="http://platform.twitter.com/widgets.js?ver=1.1"></script>
    <script>
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-10572636-6']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
</body>
</html>
