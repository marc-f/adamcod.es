<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">

    
        <title>Zend Framework 1.x, PHPUnit 3.4 and PHPUnit 3.7 side-by-side - adamcod.es</title>
    

    

    <meta name="author" content="Adam Brett">

    <!-- style -->
    <link rel="stylesheet" href="/css/style.css" type="text/css" media="screen, projection">

    <!-- RSS -->
    <link rel="alternate" type="application/rss+xml" href="http://feeds.feedburner.com/adamcodes/">

    <!-- fonts -->
    <link href="http://fonts.googleapis.com/css?family=Open+Sans:300,400" rel="stylesheet" type="text/css">
</head>
<body>
    <section class="layout-meta">
        <header>
            <p class="author vcard">
                <strong><a href="http://adamcod.es" rel="author">adamcod.es</a></strong><br />
                by <a href="http://adambrett.co.uk">Adam Brett</a>
            </p>
        </header>

        <nav>
            <ul>
                <!--li><a href="http://adambrett.co.uk/about">About</a></li-->
                <li><a href="/archive.html"><i class="icon-book"></i> Archive</a></li>
                <li><a href="http://feeds.feedburner.com/adamcodes/"><i class="icon-rss"></i> Subscribe</a></li>
                <li><a href="http://twitter.com/sixdaysad/"><i class="icon-twitter"></i> Contact</a></li>
            </ul>
        </nav>
    </section>

    <section class="layout-main">
        <article>
    <div class="instapaper_ignore entry-unrelated">

    <h1 class="entry-title"><a href="http://adamcod.es/2013/05/30/zend-1.x-phpunit-3.4-and-3.7-composer.html">Zend Framework 1.x, PHPUnit 3.4 and PHPUnit 3.7 side-by-side</a></h1>
    <p class="meta"><time pubdate class="published" datetime="2013-05-30">Thursday, May 30, 2013</time></p>
    <div class="twitter-button">
        
        <a href="https://twitter.com/share" class="twitter-share-button" data-url="http://adamcod.es/2013/05/30/zend-1.x-phpunit-3.4-and-3.7-composer.html" data-text="Zend Framework 1.x, PHPUnit 3.4 and PHPUnit 3.7 side-by-side by @sixdaysad">Tweet</a>
        
    </div>

    


    </div>

    <div class="entry-content">
        <p>Zend Framework 1.x will never support a version of PHPUnit greater than 3.4<sup id="fnref:1"><a href="#fn:1" class="footnote">1</a></sup>.  This means if you have a system-wide install of PHPUnit available (likely 3.7 at the time of writing) you will be unable to use the <code>phpunit</code> command with your Zend Framework project without getting errors.</p>

<p>The solution to this is to do a local installation of PHPUnit 3.4 for each Zend Framework 1.x project you want to work on.  The only problem is, composer support wasn’t added until PHPUnit 3.7, so installing via composer is out and you have to use PEAR.</p>

<h2 id="default-setup">Default Setup</h2>

<p><em>BUT WAIT!</em>  I hear you cry.  <em>Doesn’t composer have the ability to install PEAR packages</em>.  Yes, it does, so let’s give it a try.</p>

<pre><code>cd ~/Projects
mkdir zf-phpunit
cd zf-phpunit
composer init
</code></pre>

<p>Fill in the details until you get to the section that asks you to define your dependencies interactively, then add zendframework1, and continue:</p>

<div class="embed Flickr"><a href="http://www.flickr.com/photos/adbrett/8900729560/"><img src="http://farm8.static.flickr.com/7438/8900729560_b875186edd.jpg" title="zend-composer-install" /></a></div>

<p>Now run <code>composer install</code> and it should go off and grab a copy of zend framework 1 for you.  Once this is complete, create a new zend framework project:</p>

<pre><code>./vendor/zendframework/zendframework1/bin/zf.sh create project .
Creating project at ~/Projects/zf-phpunit
Note: This command created a web project, for more information setting up your VHOST, please see docs/README
</code></pre>

<p>Add the composer autoloader to your <code>public/index.php</code>  and <code>tests/bootstrap.php</code> files<sup id="fnref:2"><a href="#fn:2" class="footnote">2</a></sup> and you should have a fully functioning zend framework 1 project.</p>

<h2 id="running-phpunit-37">Running PHPUnit 3.7</h2>

<p>zf tool has created a default test for you automatically, so lets try and run it using our system install of phpunit:</p>

<pre><code>cd tests
phpunit --version
# PHPUnit 3.7.21 by Sebastian Bergmann.
phpunit
</code></pre>

<p>Which should give you an error something like this:</p>

<div class="embed Flickr"><a href="http://www.flickr.com/photos/adbrett/8900637907/"><img src="http://farm8.static.flickr.com/7349/8900637907_031eebe24c.jpg" title="zend-phpunit-error" /></a></div>

<p>This is what we were expecting, this error will never be fixed, which is why we need to use PHPUnit 3.4, so let’s go do that.</p>

<h2 id="the-solution">The Solution</h2>

<p>Open <code>composer.json</code> in your favourite text editor and add the following:</p>

<pre><code>"repositories": [
  {
    "type": "pear",
    "url": "http://pear.phpunit.de"
  }
],
"require-dev": {
  "pear-pear.phpunit.de/PHPUnit": "3.4.*"
}
</code></pre>

<p>Now run <code>composer update</code> to grab our new dependencies.  Composer should do its thing and you’ll be left with PHPUnit and the latest ZendFramework 1 version in <code>./vendor</code>, and a PHPUnit 3.4 executable in <code>./vendor/bin/phpunit</code>.  So let’s try running that.</p>

<div class="embed Flickr"><a href="http://www.flickr.com/photos/adbrett/8901787020/"><img src="http://farm8.static.flickr.com/7341/8901787020_94ee0fd258.jpg" title="zend-phpunit-vendored" /></a></div>

<p>Great! Right? Our tests ran perfectly.  Well yes, and <em>maybe</em> no.</p>

<h2 id="extra-credit">Extra Credit</h2>

<p>This will get you through almost everything, but in our particular case, we had to install a few dependencies for PHPUnit that composer doesn’t seem to grab:</p>

<pre><code>{
  "repositories": [
    {
      "type": "pear",
      "url": "http://pear.symfony-project.com"
    },
    {
      "type": "pear",
      "url": "http://pear.phpunit.de"
    }
  ],
  "require": {
    "zendframework/zendframework1": "1.x"
  },
  "require-dev": {
    "pear-pear.phpunit.de/File_Iterator": "1.3.2",
    "pear-pear.phpunit.de/Text_Template": "1.1.2",
    "pear-pear.phpunit.de/PHP_CodeCoverage": "1.1.*",
    "pear-pear.phpunit.de/PHP_Timer": "1.0.3",
    "pear-pear.phpunit.de/PHPUnit_MockObject": "1.1.*",
    "pear-pear.symfony-project.com/YAML": "1.0.2",
    "pear-pear.phpunit.de/PHPUnit": "3.4.*"
  }
}
</code></pre>

<p>Run <code>composer update</code> again and you should have everything installed that you need to use PHPUnit 3.4 for your project.</p>

<h2 id="read-next"> Read Next</h2>

<ul>
  <li><a href="/2013/05/10/composer-and-zend-framework-1.x.html">Composer &amp; Zend Framework 1.x</a></li>
</ul>

<div class="footnotes">
  <ol>
    <li id="fn:1">
      <p>http://framework.zend.com/issues/browse/ZF-11871<a href="#fnref:1" class="reversefootnote">&#8617;</a></p>
    </li>
    <li id="fn:2">
      <p>See: <a href="/2013/05/10/composer-and-zend-framework-1.x.md">Composer &amp; Zend Framework 1.x</a> to get Zend Framework working with Composer<a href="#fnref:2" class="reversefootnote">&#8617;</a></p>
    </li>
  </ol>
</div>

    </div>

    <section>
        <form class="well form-inline text-center" action="https://tinyletter.com/adambrett" method="post" target="popupwindow" onsubmit="window.open('https://tinyletter.com/adambrett', 'popupwindow', 'scrollbars=yes,width=800,height=600');return true">
    <p>For more exclusive content, including screen-casts, videos, and early beta access to my projects, subscribe to my email list below.</p>
    <p>
        <input type="text" name="email" placeholder="Enter your email address" /> <input type="submit" value="Subscribe" class="btn btn-primary" />
    </p>

    <input type="hidden" value="1" name="embed"/>
</form>

    </section>

    <hr>

    <footer>
        <p><small>I love discussion, but not blog comments.  If you want to comment on what's written above, head over to <a href="https://twitter.com/sixdaysad">twitter</a> or <a href="https://alpha.app.net/adambrett">ADN</a>.</small></p>
    </footer>
</article>


<hr>

<ul class="pager">
    
    <li class="previous">
        <a href="/2013/05/10/composer-and-zend-framework-1.x.html">&larr; Previous</a>
    </li>
    

    
    <li class="next">
        <a href="/2013/06/04/deploy-a-basic-lamp-stack-digital-ocean-chef-solo.html">Next &rarr;</a>
    </li>
    
</ul>


        <footer>
            <p>Copyright &copy; 2012 <a href="http://adambrett.co.uk">Adam Brett</a>.  All rights reserved.</p>
        </footer>
    </section>

    <script>
        function setImageHeight() {
          var baseLine = 26, img, _i, _len, _ref, _results;
          _ref = document.getElementsByTagName('img');
          _results = [];
          for (_i = 0, _len = _ref.length; _i < _len; _i++) {
            img = _ref[_i];
            _results.push(img.style.height = Math.ceil(img.clientHeight / baseLine) * baseLine + "px");
          }
          return _results;
        }

        if (window.addEventListener) {
          window.addEventListener('load', setImageHeight, false);
        } else if (window.attachEvent)  {
          window.attachEvent('onload', setImageHeight);
        }
    </script>
    <script src="http://platform.twitter.com/widgets.js?ver=1.1"></script>
    <script>
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-10572636-6']);
      _gaq.push(['_trackPageview']);

      setTimeout(function() {
        window.onscroll = function() {
          window.onscroll = null; // Only track the event once
          _gaq.push(['_trackEvent', 'scroll', 'read']);
        }
      }, 5000);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
</body>
</html>
