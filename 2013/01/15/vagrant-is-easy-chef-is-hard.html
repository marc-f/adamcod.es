<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">

    
        <title>Vagrant is easy - Chef is hard. - adamcod.es</title>
    

    

    <meta name="author" content="Adam Brett">

    <!-- style -->
    <link rel="stylesheet" href="/css/style.css" type="text/css" media="screen, projection">

    <!-- RSS -->
    <link rel="alternate" type="application/rss+xml" href="http://feeds.feedburner.com/adamcodes/">

    <!-- fonts -->
    <link href="http://fonts.googleapis.com/css?family=Open+Sans:300,400" rel="stylesheet" type="text/css">
</head>
<body>
    <section class="layout-meta">
        <header>
            <p class="author vcard">
                <strong><a href="http://adamcod.es" rel="author">adamcod.es</a></strong><br />
                by <a href="http://adambrett.co.uk">Adam Brett</a>
            </p>
        </header>

        <nav>
            <ul>
                <!--li><a href="http://adambrett.co.uk/about">About</a></li-->
                <li><a href="/archive.html"><i class="icon-book"></i> Archive</a></li>
                <li><a href="http://feeds.feedburner.com/adamcodes/"><i class="icon-rss"></i> Subscribe</a></li>
                <li><a href="http://twitter.com/sixdaysad/"><i class="icon-twitter"></i> Contact</a></li>
            </ul>
        </nav>
    </section>

    <section class="layout-main">
        <article>
    <div class="instapaper_ignore entry-unrelated">

    <h1 class="entry-title"><a href="http://adamcod.es/2013/01/15/vagrant-is-easy-chef-is-hard.html">Vagrant is easy - Chef is hard.</a></h1>
    <p class="meta"><time pubdate class="published" datetime="2013-01-15">Tuesday, January 15, 2013</time></p>
    <div class="twitter-button">
        
        <a href="https://twitter.com/share" class="twitter-share-button" data-url="http://adamcod.es/2013/01/15/vagrant-is-easy-chef-is-hard.html" data-text="Vagrant is easy - Chef is hard. by @sixdaysad">Tweet</a>
        
    </div>

    


    </div>

    <div class="entry-content">
        <p>This is part 1 of a 2 part quickstart to using Vagrant and Chef to speed up and simplify your development environment.  If you’re already familiar with Vagrant and just want to find out about Chef, go to <a href="/2013/01/15/vagrant-is-easy-chef-is-hard-part2.html">part 2 here</a>.</p>

<p>If you haven’t started using Chef<sup id="fnref:1"><a href="#fn:1" class="footnote">1</a></sup> and Vagrant<sup id="fnref:2"><a href="#fn:2" class="footnote">2</a></sup> yet, you should, it’s awesome and in a few short weeks has totally changed my development environment.</p>

<p>The only problem is that it’s not much use on its own, and getting started with Chef/Puppet is really really hard as there is no good documentation out there for it.  Not even the manual.  Today I’m going to change that.  If you’re a developer and just want to build a consistent and reliable test environment, as quickly and with as little hassle as possible pay close attention.</p>

<p>Just before Christmas we had a massive office refurb.  The office was shut and completely inaccessible for just over a week, which meant I spent the week working from home, without access to our UAT box.  Normally this wouldn’t be a problem, I’d just have developed locally and uploaded when back in the office, except the issue I was working on was very specific to the PHP version we were running, our ops guys wouldn’t upgrade and that meant I needed an environment as close to live as possible for testing.</p>

<p>I took this opportunity to pick-up vagrant.  I’d heard about it before, even installed it, but never really used it.</p>

<h2 id="vagrant">Vagrant</h2>

<p>Think of vagrant as a command line script for VirtualBox<sup id="fnref:3"><a href="#fn:3" class="footnote">3</a></sup>.  I’m going to skip over how to install both, as it’s really easy just following the instructions on their websites.  You will need the latest VirtualBox and Vagrant installed for this to work though.</p>

<p>There are a couple of important concepts in Vagrant</p>

<h3 id="baseboxes">Baseboxes</h3>

<p>Baseboxes are virtual machine images.  This is the default start state of your VM.  Think of setting up a new VM, then saving a snapshot so that you can restore to that point any time you want.  That’s like a basebox.  Except baseboxes are scripted, so they’re way cooler.</p>

<p>Lots of people have created baseboxes for you already<sup id="fnref:4"><a href="#fn:4" class="footnote">4</a></sup>, so you don’t need to create your own.  The default is <code>lucid32</code>, an ubuntu basebox.  This will probably be fine unless you know why you need another one.</p>

<p>Key Command (to add a new box): <code>vagrant box add lucid32 http://files.vagrantup.com/lucid32.box</code></p>

<p><code>lucid32</code> is how you’ll reference the box locally, the url is where it can be downloaded.</p>

<h3 id="vagrantfile">VagrantFile</h3>

<p><code>Vagrantfile</code> is the name of a textfile in the root of your project.  It provides all of the config settings, such as which directories on the host to mount in the VM (your code, etc), as well as networking config.</p>

<p>You’ll want to end up with a <code>Vagrantfile</code> that looks something like this:</p>

<div class="highlight"><pre><code class="ruby"><span id="True-1"><span class="ss">Vagrant</span><span class="p">:</span><span class="ss">:Config</span><span class="o">.</span><span class="n">run</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>
</span><span id="True-2">  <span class="c1"># Your local name for the basebox you want to use.</span>
</span><span id="True-3">  <span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">box</span> <span class="o">=</span> <span class="s2">&quot;lucid32&quot;</span>
</span><span id="True-4">
</span><span id="True-5">  <span class="c1"># Assign this VM to a host-only network IP, allowing you to access it</span>
</span><span id="True-6">  <span class="c1"># via the IP. Host-only networks can talk to the host machine as well as</span>
</span><span id="True-7">  <span class="c1"># any other machines on the same network, but cannot be accessed (through this</span>
</span><span id="True-8">  <span class="c1"># network interface) by any external networks.</span>
</span><span id="True-9">  <span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">network</span> <span class="ss">:hostonly</span><span class="p">,</span> <span class="s2">&quot;192.168.33.33&quot;</span>
</span><span id="True-10">
</span><span id="True-11">  <span class="c1"># Use the vagrant hostmaster plugin[^5] to automatically add a domain name</span>
</span><span id="True-12">  <span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">host_name</span> <span class="o">=</span> <span class="s2">&quot;www.example.vm&quot;</span>
</span><span id="True-13">
</span><span id="True-14">  <span class="c1"># Share an additional folder to the guest VM. The first argument is</span>
</span><span id="True-15">  <span class="c1"># an identifier, the second is the path on the guest to mount the</span>
</span><span id="True-16">  <span class="c1"># folder, and the third is the path on the host to the actual folder.</span>
</span><span id="True-17">  <span class="c1"># You can add as many of these as you like, anywhere you like</span>
</span><span id="True-18">  <span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">share_folder</span> <span class="s2">&quot;v-data&quot;</span><span class="p">,</span> <span class="s2">&quot;/srv/data&quot;</span><span class="p">,</span> <span class="s2">&quot;../data&quot;</span><span class="p">,</span> <span class="ss">:nfs</span> <span class="o">=&gt;</span> <span class="kp">true</span>
</span><span id="True-19">  <span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">share_folder</span> <span class="s2">&quot;v-site&quot;</span><span class="p">,</span> <span class="s2">&quot;/srv/site&quot;</span><span class="p">,</span> <span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="ss">:nfs</span> <span class="o">=&gt;</span> <span class="kp">true</span>
</span><span id="True-20">
</span><span id="True-21">  <span class="c1"># Enable provisioning with chef solo, specifying a cookbooks path, roles</span>
</span><span id="True-22">  <span class="c1"># path, and data_bags path (all relative to this Vagrantfile), and adding</span>
</span><span id="True-23">  <span class="c1"># some recipes and/or roles.</span>
</span><span id="True-24">  <span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="ss">:chef_solo</span> <span class="k">do</span> <span class="o">|</span><span class="n">chef</span><span class="o">|</span>
</span><span id="True-25">    <span class="n">chef</span><span class="o">.</span><span class="n">roles_path</span> <span class="o">=</span> <span class="s2">&quot;../chef/roles&quot;</span>
</span><span id="True-26">    <span class="n">chef</span><span class="o">.</span><span class="n">cookbooks_path</span> <span class="o">=</span> <span class="o">[</span><span class="s2">&quot;../chef/site-cookbooks&quot;</span><span class="p">,</span> <span class="s2">&quot;../chef/cookbooks&quot;</span><span class="o">]</span>
</span><span id="True-27">    <span class="n">chef</span><span class="o">.</span><span class="n">add_role</span> <span class="s2">&quot;webserver&quot;</span>
</span><span id="True-28">  <span class="k">end</span>
</span><span id="True-29"><span class="k">end</span>
</span></code></pre></div>

<p>Key Command (to add a new Vagrantfile to your current project): <code>vagrant init</code></p>

<h3 id="baseboxes-are-normally-empty">Baseboxes are normally empty</h3>

<p>When you have a base ubuntu install, you can’t do much with it, that’s the same with baseboxes.  While you could build a basebox that already has everything you need installed, that’s not really using it to the best of its ability.  To get anything installed, you need a provisioner, and that’s where Chef comes in.  You can also use puppet, but don’t worry too much about that for now, provisioning is the hard part and we’ll cover it in the next post.</p>

<h3 id="key-commands">Key Commands</h3>

<p>There are 6 key commands you will need day-to-day for vagrant</p>

<ul>
  <li>
    <p><code>vagrant up</code></p>

    <p>This starts the VM if it’s not already running.</p>
  </li>
  <li>
    <p><code>vagrant suspend</code></p>

    <p>This saves the machine state and temporarily shuts down the VM.  Running <code>vagrant up</code> will bring it back again exactly as it was.</p>
  </li>
  <li>
    <p><code>vagrant ssh</code></p>

    <p>Login to your VM using ssh.  Vagrant uses its own private/public keys which are automatically copied to the VM, so there’s no username/password to worry about.</p>
  </li>
  <li>
    <p><code>vagrant provision</code></p>

    <p>This re-runs your provisioner of choice (e.g. if you’ve updated something) without having to start from scratch.</p>
  </li>
  <li>
    <p><code>vagrant reload</code></p>

    <p>This resets the VM to the basebox’s original state and re-runs your provisioner.</p>
  </li>
  <li>
    <p><code>vagrant destroy</code></p>

    <p>This completely removes all trace of the VM from your system (but not the basebox or provisioner).</p>
  </li>
</ul>

<h3 id="summary">Summary</h3>

<p>This should be enough to get you started using Vagrant.  If you follow these steps, then run <code>vagrant up</code> you should have a functioning VM, and the key commands should be enough to give you a great grounding in how to use vagrant.  Now carry on reading <a href="/2013/01/15/vagrant-is-easy-chef-is-hard-part2.html">part 2</a> to find out how to make your VM actually do something useful.</p>

<div class="footnotes">
  <ol>
    <li id="fn:1">
      <p>http://www.opscode.com/chef<a href="#fnref:1" class="reversefootnote">&#8617;</a></p>
    </li>
    <li id="fn:2">
      <p>http://vagrantup.com<a href="#fnref:2" class="reversefootnote">&#8617;</a></p>
    </li>
    <li id="fn:3">
      <p>https://www.virtualbox.org<a href="#fnref:3" class="reversefootnote">&#8617;</a></p>
    </li>
    <li id="fn:4">
      <p>http://vagrantbox.es<a href="#fnref:4" class="reversefootnote">&#8617;</a></p>
    </li>
  </ol>
</div>

    </div>

    <section>
        <form class="well form-inline text-center" action="https://tinyletter.com/adambrett" method="post" target="popupwindow" onsubmit="window.open('https://tinyletter.com/adambrett', 'popupwindow', 'scrollbars=yes,width=800,height=600');return true">
    <p>For more exclusive content, including screen-casts, videos, and early beta access to my projects, subscribe to my email list below.</p>
    <p>
        <input type="text" name="email" placeholder="Enter your email address" /> <input type="submit" value="Subscribe" class="btn btn-primary" />
    </p>

    <input type="hidden" value="1" name="embed"/>
</form>

    </section>

    <hr>

    <footer>
        <p><small>I love discussion, but not blog comments.  If you want to comment on what's written above, head over to <a href="https://twitter.com/sixdaysad">twitter</a> or <a href="https://alpha.app.net/adambrett">ADN</a>.</small></p>
    </footer>
</article>


<hr>

<ul class="pager">
    
    <li class="previous">
        <a href="/2013/01/08/why-psr3-doesnt-make-sense.html">&larr; Previous</a>
    </li>
    

    
    <li class="next">
        <a href="/2013/01/15/vagrant-is-easy-chef-is-hard-part2.html">Next &rarr;</a>
    </li>
    
</ul>


        <footer>
            <p>Copyright &copy; 2012 <a href="http://adambrett.co.uk">Adam Brett</a>.  All rights reserved.</p>
        </footer>
    </section>

    <script>
        function setImageHeight() {
          var baseLine = 26, img, _i, _len, _ref, _results;
          _ref = document.getElementsByTagName('img');
          _results = [];
          for (_i = 0, _len = _ref.length; _i < _len; _i++) {
            img = _ref[_i];
            _results.push(img.style.height = Math.ceil(img.clientHeight / baseLine) * baseLine + "px");
          }
          return _results;
        }

        if (window.addEventListener) {
          window.addEventListener('load', setImageHeight, false);
        } else if (window.attachEvent)  {
          window.attachEvent('onload', setImageHeight);
        }
    </script>
    <script src="http://platform.twitter.com/widgets.js?ver=1.1"></script>
    <script>
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-10572636-6']);
      _gaq.push(['_trackPageview']);

      setTimeout(function() {
        window.onscroll = function() {
          window.onscroll = null; // Only track the event once
          _gaq.push(['_trackEvent', 'scroll', 'read']);
        }
      }, 5000);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
</body>
</html>
