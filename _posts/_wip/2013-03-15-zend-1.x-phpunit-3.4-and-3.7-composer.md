---
layout: post
title: Zend Framework 1.x, PHPUnit 3.4, PHPUnit 3.7, Side-By-Side, Composer Install
---

Zend Framework 1.x will never support a version of PHPUnit greater than 3.4[^1].  This means if you have a system-wide install of PHPUnit available (likely 3.7 at the time of writing) you will be unable to use the `phpunit` command with your Zend Framework project without getting deprecated errors.  The solution to this is to do a local installation of PHPUnit 3.4 for each Zend Framework 1.x project you want to work on.  The only problem is, composer support wasn't added until PHPUnit 3.7, so installing via composer is out and you have to use PEAR.

_BUT WAIT!_  I hear you cry.  _Doesn't composer have the ability to install PEAR packages_.  Yes, it does, so let's give it a try.

    cd ~/Projects
    zf create project phpunit-composer
    cd phpunit-composer
    touch composer.json

Now open `composer.json` in your favourite text editor and add the following:

    {
        "repositories": [
            {
                "type": "pear",
                "url": "http://pear.phpunit.de"
            }
        ],
        "require": {
            "zendframework/zendframework1": "1.*"
        },
        "require-dev": {
            "pear-pear.phpunit.de/PHPUnit": "3.4.*"
        }
    }

Great, now let's run `composer install` to kick-off our vendoring[^2].  Composer should do its thing and you'll be left with PHPUnit and the latest ZendFramework 1 version in `./vendor`.

but if you try to install PHPUnit 3.4 via Composer+PEAR in the context of a Zend Framework 1 project, you'll see something similar to this:

![PHPUnit Zend Framework 1 Composer Error](/img/posts/phpunit-zend-1.png)

The reason for this is that Composer doesn't currently understand the way PHPUnit specifies its dependencies in PEAR, so doesn't install them, resulting in a whole bunch of _No such file or directory_ errors.

The solution is actually blindingly simple.  We need to visit the PHPUnit PEAR channel[^3], find all of PHPUnit 3.4's dependencies, and specify them manually in our composer.json.  We need to be explicit, as some libraries have been updated so have newer versions available that won't work with PHPUnit 3.4.  If we update our composer.json to look like this:

    {
        "repositories": [
            {
                "type": "pear",
                "url": "http://pear.symfony-project.com"
            },
            {
                "type": "pear",
                "url": "http://pear.phpunit.de"
            }
        ],
        "require": {
            "zendframework/zendframework1": "1.*"
        },
        "require-dev": {
            "pear-pear.phpunit.de/File_Iterator": "1.3.2",
            "pear-pear.phpunit.de/Text_Template": "1.1.2",
            "pear-pear.phpunit.de/PHP_CodeCoverage": "1.1.*",
            "pear-pear.phpunit.de/PHP_Timer": "1.0.3",
            "pear-pear.phpunit.de/PHPUnit_MockObject": "1.1.*",
            "pear-pear.symfony-project.com/YAML": "1.0.2",
            "pear-pear.phpunit.de/PHPUnit": "3.4.*"
        }
    }

Then run `composer update` for our project

##Â Read Next

* [Composer & Zend Framework 1.x](/2013/04/08/composer-and-zend-framework-1.x.md)

[^1]: http://framework.zend.com/issues/browse/ZF-11871
[^2]: See: [Composer & Zend Framework 1.x](/2013/04/08/composer-and-zend-framework-1.x.md) to get Zend Framework working with Composer
[^3]: http://pear.phpunit.de
