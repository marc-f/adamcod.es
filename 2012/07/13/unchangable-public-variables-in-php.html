<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">

    
        <title>Unchangable Public Variables In PHP - adamcod.es</title>
    

    
    <meta name="description" content="If you've ever had a use-case where you want to make a class property publicly read-able, but not modifiable, (without adding a getter), this is how you do it.">
    

    <meta name="author" content="Adam Brett">

    <!-- style -->
    <link rel="stylesheet" href="/css/style.css" type="text/css" media="screen, projection">

    <!-- RSS -->
    <link rel="alternate" type="application/rss+xml" href="http://feeds.feedburner.com/adamcodes/">

    <!-- fonts -->
    <link href="http://fonts.googleapis.com/css?family=Open+Sans:300,400" rel="stylesheet" type="text/css">
</head>
<body>
    <section class="layout-meta">
        <header>
            <p class="author vcard">
                <strong><a href="http://adamcod.es" rel="author">adamcod.es</a></strong><br />
                by <a href="http://adambrett.co.uk">Adam Brett</a>
            </p>
        </header>

        <nav>
            <ul>
                <!--li><a href="http://adambrett.co.uk/about">About</a></li-->
                <li><a href="/archive.html"><i class="icon-book"></i> Archive</a></li>
                <li><a href="http://feeds.feedburner.com/adamcodes/"><i class="icon-rss"></i> Subscribe</a></li>
                <li><a href="http://twitter.com/sixdaysad/"><i class="icon-twitter"></i> Contact</a></li>
            </ul>
        </nav>
    </section>

    <section class="layout-main">
        <article>
    <div class="instapaper_ignore entry-unrelated">

    <h1 class="entry-title"><a href="http://adamcod.es/2012/07/13/unchangable-public-variables-in-php.html">Unchangable Public Variables In PHP</a></h1>
    <p class="meta"><time pubdate class="published" datetime="2012-07-13">Friday, July 13, 2012</time></p>
    <div class="twitter-button">
        
        <a href="https://twitter.com/share" class="twitter-share-button" data-url="http://adamcod.es/2012/07/13/unchangable-public-variables-in-php.html" data-text="Unchangable Public Variables In PHP by @sixdaysad">Tweet</a>
        
    </div>

    


    </div>

    <div class="entry-content">
        <p>If you’ve ever had a use-case where you want to make a class property publicly readable, but not writable, (without adding a getter), this is how you do it.</p>

<h2 id="disclaimer">Disclaimer</h2>

<p>Obviously, the easiest (and probably correct/best) way to do this is to add a getter to the class that returns the value of the private/protected property.  However this is a trick to make it appear as a normal property (in case you don’t want any getters in your API, for example).</p>

<h2 id="code">Code</h2>

<p>This trick involves using PHP’s magic methods and looks like this:</p>

<div class="highlight"><pre><code class="php"><span id="True-1"><span class="cp">&lt;?php</span>
</span><span id="True-2">
</span><span id="True-3"><span class="k">class</span> <span class="nc">MagicPublicProperty</span>
</span><span id="True-4"><span class="p">{</span>
</span><span id="True-5">    <span class="k">protected</span> <span class="nv">$_primaryKey</span> <span class="o">=</span> <span class="s1">&#39;id&#39;</span><span class="p">;</span>
</span><span id="True-6">
</span><span id="True-7">    <span class="k">public</span> <span class="k">function</span> <span class="nf">__set</span><span class="p">(</span><span class="nv">$property</span><span class="p">,</span> <span class="nv">$value</span><span class="p">)</span>
</span><span id="True-8">    <span class="p">{</span>
</span><span id="True-9">        <span class="k">if</span><span class="p">(</span><span class="nv">$property</span> <span class="o">==</span> <span class="s1">&#39;primaryKey&#39;</span><span class="p">)</span> <span class="p">{</span>
</span><span id="True-10">            <span class="nv">$name</span> <span class="o">=</span> <span class="nb">get_class</span><span class="p">(</span><span class="nv">$this</span><span class="p">);</span>
</span><span id="True-11">            <span class="k">throw</span> <span class="k">new</span> <span class="nx">Exception</span><span class="p">(</span><span class="s2">&quot;Unable to set property `</span><span class="si">{</span><span class="nv">$property</span><span class="si">}</span><span class="s2">` on&quot;</span>
</span><span id="True-12">            <span class="o">.</span> <span class="s2">&quot; objects of type `</span><span class="si">{</span><span class="nv">$name</span><span class="si">}</span><span class="s2">`&quot;</span><span class="p">);</span>
</span><span id="True-13">        <span class="p">}</span>
</span><span id="True-14">    <span class="p">}</span>
</span><span id="True-15">
</span><span id="True-16">    <span class="k">public</span> <span class="k">function</span> <span class="nf">__get</span><span class="p">(</span><span class="nv">$property</span><span class="p">)</span>
</span><span id="True-17">    <span class="p">{</span>
</span><span id="True-18">        <span class="k">if</span><span class="p">(</span><span class="nv">$property</span> <span class="o">==</span> <span class="s1">&#39;primaryKey&#39;</span> <span class="o">&amp;&amp;</span> <span class="nb">isset</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_primaryKey</span><span class="p">))</span> <span class="p">{</span>
</span><span id="True-19">            <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_primaryKey</span><span class="p">;</span>
</span><span id="True-20">        <span class="p">}</span>
</span><span id="True-21">    <span class="p">}</span>
</span><span id="True-22">
</span><span id="True-23">    <span class="k">public</span> <span class="k">function</span> <span class="nf">__isset</span><span class="p">(</span><span class="nv">$property</span><span class="p">)</span>
</span><span id="True-24">    <span class="p">{</span>
</span><span id="True-25">        <span class="k">if</span><span class="p">(</span><span class="nv">$property</span> <span class="o">==</span> <span class="s1">&#39;primaryKey&#39;</span><span class="p">)</span> <span class="p">{</span>
</span><span id="True-26">            <span class="k">return</span> <span class="nb">isset</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_primaryKey</span><span class="p">);</span>
</span><span id="True-27">        <span class="p">}</span>
</span><span id="True-28">    <span class="p">}</span>
</span><span id="True-29"><span class="p">}</span>
</span></code></pre></div>

<p>Here we have a protected property that is obviously only accessible to instances of this class or child classes.</p>

<p>Below that we are using PHP’s magic methods <code>__get</code> and <code>__isset</code> to intercept calls to this class’ properties and we’re checking to see if the property attempting to be accessed is <code>primaryKey</code>.  If it is, we return either the <code>isset</code> result or the value, depending on what we want to do.  This bit is fairly straight forward.</p>

<p>To stop anyone from attempting to set the value of this property from outside of the class, we need to add something to the <code>__set</code> magic method, if we didn’t, it could lead to unexpected results.  We <em>could</em> just trap it and return, doing nothing, but to make sure no-one does this accidentally in their code expecting it work, we should throw an exception with a helpful message.</p>

<p>What if you want it to be modified from outside of the class too?</p>

<p>Make it public (duh).</p>

<h3 id="tests">Tests</h3>

<p>Here are some quick tests to prove it’s working as expected:</p>

<div class="highlight"><pre><code class="php"><span id="True-1"><span class="cp">&lt;?php</span>
</span><span id="True-2">
</span><span id="True-3"><span class="k">require_once</span> <span class="nx">__DIR__</span> <span class="o">.</span> <span class="s1">&#39;/MagicPublicProperty.php&#39;</span><span class="p">;</span>
</span><span id="True-4">
</span><span id="True-5"><span class="nv">$test</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MagicPublicProperty</span><span class="p">;</span>
</span><span id="True-6">
</span><span id="True-7"><span class="cm">/*</span>
</span><span id="True-8"><span class="cm">Added the following methods to MagicPublicProperty for the below tests:</span>
</span><span id="True-9">
</span><span id="True-10"><span class="cm">    public function changePrimaryKey() {</span>
</span><span id="True-11"><span class="cm">        $this-&gt;_primaryKey = array(</span>
</span><span id="True-12"><span class="cm">            &#39;foreign_key_1&#39;,</span>
</span><span id="True-13"><span class="cm">            &#39;foreign_key_2&#39;</span>
</span><span id="True-14"><span class="cm">        );</span>
</span><span id="True-15"><span class="cm">    }</span>
</span><span id="True-16">
</span><span id="True-17"><span class="cm">    public function removePrimaryKey() {</span>
</span><span id="True-18"><span class="cm">        unset($this-&gt;_primaryKey);</span>
</span><span id="True-19"><span class="cm">    }</span>
</span><span id="True-20">
</span><span id="True-21"><span class="cm">*/</span>
</span><span id="True-22">
</span><span id="True-23"><span class="nx">test</span><span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$test</span><span class="o">-&gt;</span><span class="na">primaryKey</span><span class="p">),</span> <span class="s1">&#39;Is set&#39;</span><span class="p">);</span>
</span><span id="True-24">
</span><span id="True-25"><span class="nx">test</span><span class="p">(</span><span class="nv">$test</span><span class="o">-&gt;</span><span class="na">primaryKey</span> <span class="o">==</span> <span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;Is accessible&#39;</span><span class="p">);</span>
</span><span id="True-26">
</span><span id="True-27"><span class="nx">test</span><span class="p">(</span><span class="k">function</span><span class="p">()</span> <span class="k">use</span> <span class="p">(</span><span class="nv">$test</span><span class="p">)</span> <span class="p">{</span>
</span><span id="True-28">    <span class="nv">$test</span><span class="o">-&gt;</span><span class="na">changePrimaryKey</span><span class="p">();</span>
</span><span id="True-29">    <span class="k">return</span> <span class="nb">is_array</span><span class="p">(</span><span class="nv">$test</span><span class="o">-&gt;</span><span class="na">primaryKey</span><span class="p">);</span>
</span><span id="True-30"><span class="p">},</span> <span class="s1">&#39;Is internally changeable&#39;</span><span class="p">);</span>
</span><span id="True-31">
</span><span id="True-32"><span class="nx">test</span><span class="p">(</span><span class="k">function</span><span class="p">()</span> <span class="k">use</span> <span class="p">(</span><span class="nv">$test</span><span class="p">)</span> <span class="p">{</span>
</span><span id="True-33">    <span class="k">try</span> <span class="p">{</span>
</span><span id="True-34">        <span class="nv">$test</span><span class="o">-&gt;</span><span class="na">primaryKey</span> <span class="o">=</span> <span class="s1">&#39;somethingelse&#39;</span><span class="p">;</span>
</span><span id="True-35">    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">Exception</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
</span><span id="True-36">        <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
</span><span id="True-37">    <span class="p">}</span>
</span><span id="True-38">
</span><span id="True-39">    <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
</span><span id="True-40"><span class="p">},</span> <span class="s1">&#39;Exception if set&#39;</span><span class="p">);</span>
</span><span id="True-41">
</span><span id="True-42"><span class="k">function</span> <span class="nf">test</span><span class="p">(</span><span class="nv">$c</span><span class="p">,</span><span class="nv">$m</span><span class="p">)</span> <span class="p">{</span>
</span><span id="True-43">    <span class="nv">$c</span> <span class="o">=</span> <span class="p">(</span><span class="nb">is_callable</span><span class="p">(</span><span class="nv">$c</span><span class="p">))</span> <span class="o">?</span> <span class="nv">$c</span><span class="p">()</span> <span class="o">:</span> <span class="nv">$c</span><span class="p">;</span>
</span><span id="True-44">    <span class="k">if</span><span class="p">(</span><span class="nv">$c</span><span class="p">)</span> <span class="p">{</span>
</span><span id="True-45">        <span class="k">echo</span> <span class="s2">&quot;</span><span class="si">$m</span><span class="s2">: Passed</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
</span><span id="True-46">    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span id="True-47">        <span class="k">echo</span> <span class="s2">&quot;</span><span class="si">$m</span><span class="s2">: Failed</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
</span><span id="True-48">    <span class="p">}</span>
</span><span id="True-49"><span class="p">}</span>
</span><span id="True-50"><span class="k">echo</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">;</span>
</span></code></pre></div>

<p>and the results:</p>

<pre><code>Is set: Passed
Is accessible: Passed
Is internally changeable: Passed
Exception if set: Passed
</code></pre>

    </div>

    <section>
        <form class="well form-inline text-center" action="https://tinyletter.com/adambrett" method="post" target="popupwindow" onsubmit="window.open('https://tinyletter.com/adambrett', 'popupwindow', 'scrollbars=yes,width=800,height=600');return true">
    <p>For more exclusive content, including screen-casts, videos, and early beta access to my projects, subscribe to my email list below.</p>
    <p>
        <input type="text" name="email" placeholder="Enter your email address" /> <input type="submit" value="Subscribe" class="btn btn-primary" />
    </p>

    <input type="hidden" value="1" name="embed"/>
</form>

    </section>

    <hr>

    <footer>
        <p><small>I love discussion, but not blog comments.  If you want to comment on what's written above, head over to <a href="https://twitter.com/sixdaysad">twitter</a> or <a href="https://alpha.app.net/adambrett">ADN</a>.</small></p>
    </footer>
</article>


<hr>

<ul class="pager">
    
    <li class="previous">
        <a href="/2012/07/10/unable-to-run-adb-andriod-ubuntu-eclipse.html">&larr; Previous</a>
    </li>
    

    
    <li class="next">
        <a href="/2012/07/17/cakephp-class-string-not-found.html">Next &rarr;</a>
    </li>
    
</ul>


        <footer>
            <p>Copyright &copy; 2012 <a href="http://adambrett.co.uk">Adam Brett</a>.  All rights reserved.</p>
        </footer>
    </section>

    <script>
        function setImageHeight() {
          var baseLine = 26, img, _i, _len, _ref, _results;
          _ref = document.getElementsByTagName('img');
          _results = [];
          for (_i = 0, _len = _ref.length; _i < _len; _i++) {
            img = _ref[_i];
            _results.push(img.style.height = Math.ceil(img.clientHeight / baseLine) * baseLine + "px");
          }
          return _results;
        }

        if (window.addEventListener) {
          window.addEventListener('load', setImageHeight, false);
        } else if (window.attachEvent)  {
          window.attachEvent('onload', setImageHeight);
        }
    </script>
    <script src="http://platform.twitter.com/widgets.js?ver=1.1"></script>
    <script>
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-10572636-6']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        // ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        ga.src = ('https:' == document.location.protocol ? 'https://' : 'http://') + 'stats.g.doubleclick.net/dc.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
</body>
</html>
