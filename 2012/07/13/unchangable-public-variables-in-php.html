<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">

    
        <title>Unchangable Public Variables In PHP - adamcod.es</title>
    

    
    <meta name="description" content="If you've ever had a use-case where you want to make a class property publicly read-able, but not modifiable, (without adding a getter), this is how you do it.">
    

    <meta name="author" content="Adam Brett">

    <!-- style -->
    <link rel="stylesheet" href="/css/style.css" type="text/css" media="screen, projection">

    <!-- RSS -->
    <link rel="alternate" type="application/rss+xml" href="http://feeds.feedburner.com/adamcodes/">

    <!-- fonts -->
    <link href="http://fonts.googleapis.com/css?family=Cardo|Open+Sans:300,400" rel="stylesheet" type="text/css">

    <!--[if lt IE 9]>
    <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
</head>
<body>
    <section class="layout-meta">
        <header>
            <p class="author vcard">
                <strong><a href="http://adamcod.es" rel="author">adamcod.es</a></strong><br />
                by <a href="http://adambrett.co.uk">Adam Brett</a>
            </p>
        </header>

        <nav>
            <ul>
                <!--li><a href="http://adambrett.co.uk/about">About</a></li-->
                <li><a href="/archive.html"><i class="icon-book"></i> Archive</a></li>
                <li><a href="http://feeds.feedburner.com/adamcodes/"><i class="icon-rss"></i> Subscribe</a></li>
                <li><a href="http://twitter.com/sixdaysad/"><i class="icon-twitter"></i> Contact</a></li>
            </ul>
        </nav>
    </section>

    <section class="layout-main">
        <article>
    <div class="instapaper_ignore entry-unrelated">

    <h1 class="entry-title"><a href="http://adamcod.es/2012/07/13/unchangable-public-variables-in-php.html">Unchangable Public Variables In PHP</a></h1>
    <p class="meta"><time pubdate class="published" datetime="2012-07-13">Friday, July 13, 2012</time></p>
    <div class="twitter-button">
        
        <a href="https://twitter.com/share" class="twitter-share-button" data-url="http://adamcod.es/2012/07/13/unchangable-public-variables-in-php.html" data-text="Unchangable Public Variables In PHP by @sixdaysad">Tweet</a>
        
    </div>

    <div class="alert alert-warning">
  <h4>Out Of Date Warning</h4>

  <p>
    This article was published on <strong>Friday, July 13, 2012</strong> which was
    <strong>more than 6 months ago </strong>, this means the content may be
    out of date or no longer relevant.  You should <strong>verify that the
    technical information in this article is still current</strong> before
    relying upon it for your own purposes.
  </p>
</div>



    </div>

    <div class="entry-content">
        <p>If you’ve ever had a use-case where you want to make a class property publicly readable, but not writable, (without adding a getter), this is how you do it.</p>

<h2 id="disclaimer">Disclaimer</h2>

<p>Obviously, the easiest (and probably correct/best) way to do this is to add a getter to the class that returns the value of the private/protected property.  However this is a trick to make it appear as a normal property (in case you don’t want any getters in your API, for example).</p>

<h2 id="code">Code</h2>

<p>This trick involves using PHP’s magic methods and looks like this:</p>

<div><script src="https://gist.github.com/3104351.js?file=MagicPublicProperty.php"></script>
<noscript><pre><code>&lt;?php

class MagicPublicProperty {
    protected $_primaryKey = &#39;id&#39;;

    public function __set($property, $value) {
        if($property == &#39;primaryKey&#39;) {
            $name = get_class($this);
            throw new Exception(&quot;Unable to set property `{$property}` on&quot;
                . &quot; objects of type `{$name}`&quot;);
        }
    }

    public function __get($property) {
        if($property == &#39;primaryKey&#39; &amp;&amp; isset($this-&gt;_primaryKey)) {
            return $this-&gt;_primaryKey;
        }
    }

    public function __isset($property) {
        if($property == &#39;primaryKey&#39;) {
            return isset($this-&gt;_primaryKey);
        }
    }
}</code></pre></noscript></div>

<p>Here we have a protected property that is obviously only accessible to instances of this class or child classes.</p>

<p>Below that we are using PHP’s magic methods <code>__get</code> and <code>__isset</code> to intercept calls to this class’ properties and we’re checking to see if the property attempting to be accessed is <code>primaryKey</code>.  If it is, we return either the <code>isset</code> result or the value, depending on what we want to do.  This bit is fairly straight forward.</p>

<p>To stop anyone from attempting to set the value of this property from outside of the class, we need to add something to the <code>__set</code> magic method, if we didn’t, it could lead to unexpected results.  We <em>could</em> just trap it and return, doing nothing, but to make sure no-one does this accidentally in their code expecting it work, we should throw an exception with a helpful message.</p>

<p>What if you want it to be modified from outside of the class too?</p>

<p>Make it public (duh).</p>

<h3 id="tests">Tests</h3>

<p>Here are some quick tests to prove it’s working as expected:</p>

<div><script src="https://gist.github.com/3104351.js?file=tests.php"></script>
<noscript><pre><code>&lt;?php

require_once __DIR__ . &#39;/MagicPublicProperty.php&#39;;

$test = new MagicPublicProperty;

/*
Added the following methods to MagicPublicProperty for the below tests:

    public function changePrimaryKey() {
        $this-&gt;_primaryKey = array(
            &#39;foreign_key_1&#39;,
            &#39;foreign_key_2&#39;
        );
    }

    public function removePrimaryKey() {
        unset($this-&gt;_primaryKey);
    }

*/

test(isset($test-&gt;primaryKey), &#39;Is set&#39;);

test($test-&gt;primaryKey == &#39;id&#39;, &#39;Is accessible&#39;);

test(function() use ($test) {
    $test-&gt;changePrimaryKey();
    return is_array($test-&gt;primaryKey);
}, &#39;Is internally changeable&#39;);

test(function() use ($test) {
    try {
        $test-&gt;primaryKey = &#39;somethingelse&#39;;
    } catch (Exception $e) {
        return true;
    }

    return false;
}, &#39;Exception if set&#39;);

function test($c,$m) {
    $c = (is_callable($c)) ? $c() : $c;
    if($c) {
        echo &quot;$m: Passed\n&quot;;
    } else {
        echo &quot;$m: Failed\n&quot;;
    }
}
echo &quot;\n\n&quot;;</code></pre></noscript></div>

<p>and the results:</p>

<div><script src="https://gist.github.com/3104351.js?file=results"></script>
<noscript><pre><code>Is set: Passed
Is accessible: Passed
Is internally changeable: Passed
Exception if set: Passed</code></pre></noscript></div>


    </div>

    <section>
        <form class="well form-inline" action="https://tinyletter.com/adambrett" method="post" target="popupwindow" onsubmit="window.open('https://tinyletter.com/adambrett', 'popupwindow', 'scrollbars=yes,width=800,height=600');return true">
    <p>For more exclusive content, including screen-casts, videos, and early beta access to my projects, subscribe to my email list below.</p>
    <p class="text-center">
        <input type="text" name="email" placeholder="Enter your email address" /> <input type="submit" value="Subscribe" class="btn btn-success" />
    </p>

    <input type="hidden" value="1" name="embed"/>
</form>

    </section>

    <hr>

    <footer>
        <p><small>I love discussion, but not blog comments.  If you want to comment on what's written above, head over to <a href="https://twitter.com/sixdaysad">twitter</a> or <a href="https://alpha.app.net/adambrett">ADN</a>.</small></p>
    </footer>
</article>


<hr>

<ul class="pager" />
    
    <li class="previous">
        <a href="/2012/07/10/unable-to-run-adb-andriod-ubuntu-eclipse.html">&larr; Previous</a>
    </li>
    

    
    <li class="next">
        <a href="/2012/07/17/cakephp-class-string-not-found.html">Next &rarr;</a>
    </li>
    
</ul>


        <footer>
            <p>Copyright &copy; 2012 <a href="http://adambrett.co.uk">Adam Brett</a>.  All rights reserved.</p>
        </footer>
    </section>

    <script type="text/javascript" src="http://platform.twitter.com/widgets.js?ver=1.1"></script>
    <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-10572636-6']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
</body>
</html>
