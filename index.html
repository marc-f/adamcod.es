<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">

    
        <title>words on code - adamcod.es</title>
    

    

    <meta name="author" content="Adam Brett">

    <!-- style -->
    <link rel="stylesheet" href="/css/style.css" type="text/css" media="screen, projection">

    <!-- RSS -->
    <link rel="alternate" type="application/rss+xml" href="http://feeds.feedburner.com/adamcodes/">

    <!-- fonts -->
    <link href="http://fonts.googleapis.com/css?family=Open+Sans:300,400" rel="stylesheet" type="text/css">
</head>
<body>
    <section class="layout-meta">
        <header>
            <p class="author vcard">
                <strong><a href="http://adamcod.es" rel="author">adamcod.es</a></strong><br />
                by <a href="http://adambrett.co.uk">Adam Brett</a>
            </p>
        </header>

        <nav>
            <ul>
                <!--li><a href="http://adambrett.co.uk/about">About</a></li-->
                <li><a href="/archive.html"><i class="icon-book"></i> Archive</a></li>
                <li><a href="http://feeds.feedburner.com/adamcodes/"><i class="icon-rss"></i> Subscribe</a></li>
                <li><a href="http://twitter.com/sixdaysad/"><i class="icon-twitter"></i> Contact</a></li>
            </ul>
        </nav>
    </section>

    <section class="layout-main">
        

<article>
    <div class="instapaper_ignore entry-unrelated">


    <h1 class="entry-title"><a href="http://adamcod.es/2013/09/10/interface-segregation-principle-zend-framework.html">Interface-Segregation Principle in the Context of Zend Framework 1.x</a></h1>
    <p class="meta"><time pubdate class="published" datetime="2013-09-10">Tuesday, September 10, 2013</time></p>
    
    <a href="https://twitter.com/share" class="twitter-share-button" data-url="http://adamcod.es/2013/09/10/interface-segregation-principle-zend-framework.html" data-text="Interface-Segregation Principle in the Context of Zend Framework 1.x by @sixdaysad">Tweet</a>
    

    </div>

    <div class="entry-content">
        <p>The interface-segregation principle is the <em>I</em> in the SOLID<sup id="fnref:1"><a href="#fn:1" class="footnote">1</a></sup> acronym that describes the 5 basic principles of good object oriented design.  It states that no client (read: <em>object</em>) should be forced to depend on methods it does not use.</p>

<p>Take this simple snippet that that will probably be familiar to most of you:</p>

<div class="highlight"><pre><code class="php"><span class="cp">&lt;?php</span>
<span class="k">class</span> <span class="nc">SomeMapper</span>
<span class="p">{</span>
    <span class="k">protected</span> <span class="nv">$gateway</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">(</span><span class="nx">Zend_Db_Table_Abstract</span> <span class="nv">$someGateway</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">gateway</span> <span class="o">=</span> <span class="nv">$someGateway</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p>This is a fairly simple form of Dependency Injection where the gateway that we’re operating on is injected in to our mapper, meaning that we could pass any subclass of <code>Zend_Db_Table_Abstract</code> to our mapper when we construct it and safely expect all of the methods of <code>Zend_Db_Table_Abstract</code> to be available to us.</p>

<p>Let’s take a look at the methods available to us in <code>Zend_Db_Table_Abstract</code>:</p>

<pre><code>setOptions
setDefinition
getDefinition
setDefinitionConfigName
getDefinitionConfigName
setRowClass
getRowClass
setRowsetClass
getRowsetClass
addReference
setReferences
getReference
setDependentTables
getDependentTables
setDefaultSource
getDefaultSource
setDefaultValues
getDefaultValues
setDefaultAdapter
getDefaultAdapter
getAdapter
setDefaultMetadataCache
getDefaultMetadataCache
getMetadataCache
setMetadataCacheInClass
metadataCacheInClass
init
info
select
insert
isIdentity
update
delete
find
fetchAll
fetchRow
fetchNew
createRow
</code></pre>

<p>That’s 38 methods that are available to our mapper.</p>

<p>In reality, does our mapper need to use all of those?  Chances are it doesn’t, but if we type hint on <code>Zend_Db_Table_Abstract</code>, any object we pass in to our mapper will <em>have</em> to implement all of those methods<sup id="fnref:2"><a href="#fn:2" class="footnote">2</a></sup>.</p>

<p>The interface-segregation principle <strong>requires</strong> us to use a better way.  If we expand on our mapper a little bit, we could end up with something like this:</p>

<div class="highlight"><pre><code class="php"><span class="cp">&lt;?php</span>
<span class="k">class</span> <span class="nc">SomeMapper</span>
<span class="p">{</span>
    <span class="k">protected</span> <span class="nv">$gateway</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">(</span><span class="nx">Zend_Db_Table_Abstract</span> <span class="nv">$someGateway</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">gateway</span> <span class="o">=</span> <span class="nv">$someGateway</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">findAllByName</span><span class="p">(</span><span class="nv">$name</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$select</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">gateway</span><span class="o">-&gt;</span><span class="na">select</span><span class="p">()</span>
            <span class="o">-&gt;</span><span class="na">from</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">gateway</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;name = ?&#39;</span><span class="p">,</span> <span class="nv">$name</span><span class="p">);</span>

        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">gateway</span><span class="o">-&gt;</span><span class="na">fetchAll</span><span class="p">(</span><span class="nv">$select</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p>This is a fairly common use-case.  We only use a few methods from <code>Zend_Db_Table_Abstract</code> in our mapper, so why not create an interface just for those methods:</p>

<div class="highlight"><pre><code class="php"><span class="cp">&lt;?php</span>
<span class="k">interface</span> <span class="nx">SelectableInterface</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">select</span><span class="p">();</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">fetchAll</span><span class="p">(</span><span class="nx">Zend_Db_Select</span> <span class="nv">$select</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<p>Now we should make sure our mapper depend on this interface, instead of the full <code>Zend_Db_Table_Abstract</code> interface:</p>

<div class="highlight"><pre><code class="php"><span class="cp">&lt;?php</span>
<span class="k">class</span> <span class="nc">SomeMapper</span>
<span class="p">{</span>
    <span class="k">protected</span> <span class="nv">$gateway</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">(</span><span class="nx">SelectableInterface</span> <span class="nv">$someGateway</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">gateway</span> <span class="o">=</span> <span class="nv">$someGateway</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// ... snip ...</span>
</code></pre></div>

<p>Now, we make sure our concrete gateway class implements our new interface, like so:</p>

<div class="highlight"><pre><code class="php"><span class="cp">&lt;?php</span>
<span class="k">class</span> <span class="nc">OurGateway</span> <span class="k">extends</span> <span class="nx">Zend_Db_Table_Abstract</span> <span class="k">implements</span> <span class="nx">SelectableInterface</span>
<span class="p">{}</span>
</code></pre></div>

<p>We don’t actually need to add any methods, as <code>Zend_Db_Table_Abstract</code> implements them for us.</p>

<p>The benefits are immediately obvious here.  Let’s say we don’t want to use <code>Zend_Db_Table_Abstract</code> for our gateway anymore, and instead we just want to use PDO straight-up.</p>

<div class="highlight"><pre><code class="php"><span class="cp">&lt;?php</span>
<span class="k">class</span> <span class="nc">OurGateway</span> <span class="k">implements</span> <span class="nx">SelectableInterface</span>
<span class="p">{</span>
    <span class="k">protected</span> <span class="nv">$pdo</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">(</span><span class="nx">PDO</span> <span class="nv">$pdo</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">pdo</span> <span class="o">=</span> <span class="nv">$pdo</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">select</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// fetch all type hints on Zend_Db_Select and as it just returns</span>
        <span class="c1">// SQL in its __toString method there shouldn&#39;t be a problem</span>
        <span class="c1">// using it with PDO.</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nx">Zend_Db_Select</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">fetchAll</span><span class="p">(</span><span class="nx">Zend_Db_Select</span> <span class="nv">$select</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$statement</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">pdo</span><span class="o">-&gt;</span><span class="na">query</span><span class="p">(</span><span class="nv">$select</span><span class="p">);</span>
        <span class="k">return</span> <span class="nv">$statement</span><span class="o">-&gt;</span><span class="na">fetchAll</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p>This implementation still works with our mapper just as well as the original which was based on <code>Zend_Db_Table_Abstract</code>.</p>

<p>But what about when you want to add some more methods to the gateway?  I don’t like to build any SQL outside of my gateways, as I don’t think mappers should have knowledge of the underlying data-structure, so let’s move our <code>findAllByName</code> method’s SQL building part down a level, to the gateway:</p>

<div class="highlight"><pre><code class="php"><span class="cp">&lt;?php</span>
<span class="k">class</span> <span class="nc">OurGateway</span> <span class="k">extends</span> <span class="nx">Zend_Db_Table_Abstract</span> <span class="k">implements</span> <span class="nx">FetchableInterface</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">getFindAllByNameSelect</span><span class="p">(</span><span class="nv">$name</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">select</span><span class="p">()</span>
            <span class="o">-&gt;</span><span class="na">from</span><span class="p">(</span><span class="nv">$this</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;name = ?&#39;</span><span class="p">,</span> <span class="nv">$name</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p>And the relevant mapper:</p>

<div class="highlight"><pre><code class="php"><span class="cp">&lt;?php</span>
<span class="k">class</span> <span class="nc">SomeMapper</span>
<span class="p">{</span>
    <span class="k">protected</span> <span class="nv">$gateway</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">(</span><span class="nx">FetchableInterface</span> <span class="nv">$someGateway</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">gateway</span> <span class="o">=</span> <span class="nv">$someGateway</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">findAllByName</span><span class="p">(</span><span class="nv">$name</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">gateway</span><span class="o">-&gt;</span><span class="na">fetchAll</span><span class="p">(</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">gateway</span><span class="o">-&gt;</span><span class="na">getFindAllByNameSelect</span><span class="p">()</span>
        <span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p>and finally the updated interface:</p>

<div class="highlight"><pre><code class="php"><span class="cp">&lt;?php</span>
<span class="k">interface</span> <span class="nx">FetchableInterface</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">fetchAll</span><span class="p">(</span><span class="nx">Zend_Db_Select</span> <span class="nv">$select</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<p>This example is somewhat contrived, you wouldn’t implement these classes this way in real life, but I want to use them to illustrait a point.</p>

<p>The <code>FetchableInterface</code> doesn’t require the <code>getFindAllByNameSelect</code> method to be present, but our mapper depends on it.  The reason for this is that we want our interfaces to be as small as possible.  The smallest possible (useful) interface for our gateways is the <code>FetchableInterface</code>; saying that we can fetch all instances of an object from that gateway based on a <code>Zend_Db_Select</code> object.</p>

<p>Not all of our gateways are going to have a <code>getFindAllByNameSelect</code> method, so we don’t want to add it to our interface that may well be used for a large number of our gateways.  So for our <code>getFindAllByNameSelect</code> method, we create another interface:</p>

<div class="highlight"><pre><code class="php"><span class="cp">&lt;?php</span>
<span class="k">interface</span> <span class="nx">FindByNameInterface</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">getFindAllByNameSelect</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div>

<p>Fortunately, PHP lets you implement multiple interfaces, so we can update our gateway to enforce this:</p>

<div class="highlight"><pre><code class="php"><span class="cp">&lt;?php</span>
<span class="k">class</span> <span class="nc">OurGateway</span> <span class="k">extends</span> <span class="nx">Zend_Db_Table_Abstract</span>
    <span class="k">implements</span> <span class="nx">FetchableInterface</span><span class="p">,</span> <span class="nx">FindByNameInterface</span>
<span class="p">{</span>
    <span class="c1">// ... snip ...</span>
<span class="p">}</span>
</code></pre></div>

<p>But this leads to a problem:  We can’t type hint on multiple interfaces in our mapper.  Thankfully, PHP has a little-known feature in that interfaces can use multiple inheritance.  That means we can create a new third interface that our mapper <em>can</em> type hint on:</p>

<div class="highlight"><pre><code class="php"><span class="cp">&lt;?php</span>
<span class="k">interface</span> <span class="nx">FetchableByNameInterface</span>
    <span class="k">extends</span> <span class="nx">FetchableInterface</span><span class="p">,</span> <span class="nx">FindByNameInterface</span>
<span class="p">{</span>

<span class="p">}</span>
</code></pre></div>

<p>This interface doesn’t need any methods (though you could add some if you wanted to), as it inherits methods from both <code>FetchableInterface</code> and <code>FindByNameInterface</code>.  Now we can update our mapper to type hint on this new interface:</p>

<div class="highlight"><pre><code class="php"><span class="cp">&lt;?php</span>
<span class="k">class</span> <span class="nc">SomeMapper</span>
<span class="p">{</span>
    <span class="k">protected</span> <span class="nv">$gateway</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">(</span><span class="nx">FetchableByNameInterface</span> <span class="nv">$someGateway</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">gateway</span> <span class="o">=</span> <span class="nv">$someGateway</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// ... snip ...</span>
<span class="p">}</span>
</code></pre></div>

<p>and our gateway:</p>

<div class="highlight"><pre><code class="php"><span class="cp">&lt;?php</span>
<span class="k">class</span> <span class="nc">OurGateway</span> <span class="k">extends</span> <span class="nx">Zend_Db_Table_Abstract</span>
    <span class="k">implements</span> <span class="nx">FetchableByNameInterface</span>
<span class="p">{</span>
    <span class="c1">// ... snip ...</span>
<span class="p">}</span>
</code></pre></div>

<p>As I said before, the examples here are somewhere contrived, and could be achieved in different or simpler ways (such as <code>FindByNameInterface</code> extending <code>FetchableInterface</code>), but the main point of this post was to demonstrait how to use multiple-inheritance with interfaces to achieve really nice and simple interface-segregation.</p>

<p>Hopefully armed with this knowledge you can go out and start creating objects that depend on the smallest possible interface, which will help you write easier and smaller unit tests (fewer methods to mock), and more reliable and robust code that is ultimately easier to maintain too!</p>

<h2 id="read-next">Read Next:</h2>

<ul>
  <li><a href="http://3v4l.org/Yff7T">Example of this code on 80+ PHP versions</a></li>
  <li><a href="/2013/05/30/zend-1.x-phpunit-3.4-and-3.7-composer.html">Zend Framework 1.x, PHPUnit 3.4 and PHPUnit 3.7 side-by-side</a></li>
</ul>

<div class="footnotes">
  <ol>
    <li id="fn:1">
      <p>http://en.wikipedia.org/wiki/SOLID_%28object-oriented_design%29<a href="#fnref:1" class="reversefootnote">&#8617;</a></p>
    </li>
    <li id="fn:2">
      <p>Actually, as <code>Zend_Db_Table_Abstract</code> is an abstract class and not an interface it will need to <em>extend</em> Zend_Db_Table_Abstract which already has all of those methods implemented.<a href="#fnref:2" class="reversefootnote">&#8617;</a></p>
    </li>
  </ol>
</div>

    </div>

    <section>
        <form class="well form-inline text-center" action="https://tinyletter.com/adambrett" method="post" target="popupwindow" onsubmit="window.open('https://tinyletter.com/adambrett', 'popupwindow', 'scrollbars=yes,width=800,height=600');return true">
    <p>For more exclusive content, including screen-casts, videos, and early beta access to my projects, subscribe to my email list below.</p>
    <p>
        <input type="text" name="email" placeholder="Enter your email address" /> <input type="submit" value="Subscribe" class="btn btn-primary" />
    </p>

    <input type="hidden" value="1" name="embed"/>
</form>

    </section>

    <hr>

    <footer>
        <p><small>I love discussion, but not blog comments.  If you want to comment on what's written above, head over to <a href="https://twitter.com/sixdaysad">twitter</a> or <a href="https://alpha.app.net/adambrett">ADN</a>.</small></p>
    </footer>
</article>


<hr>

<ul class="pager" />
    
    <li class="previous">
        <a href="/2013/08/27/one-thing-i-wish-i-knew-opscode-chef.html">&larr; Previous</a>
    </li>
    
</ul>


        <footer>
            <p>Copyright &copy; 2012 <a href="http://adambrett.co.uk">Adam Brett</a>.  All rights reserved.</p>
        </footer>
    </section>

    <script>
        function setImageHeight() {
          var baseLine = 26, img, _i, _len, _ref, _results;
          _ref = document.getElementsByTagName('img');
          _results = [];
          for (_i = 0, _len = _ref.length; _i < _len; _i++) {
            img = _ref[_i];
            _results.push(img.style.height = Math.ceil(img.clientHeight / baseLine) * baseLine + "px");
          }
          return _results;
        }

        if (window.addEventListener) {
          window.addEventListener('load', setImageHeight, false);
        } else if (window.attachEvent)  {
          window.attachEvent('onload', setImageHeight);
        }
    </script>
    <script src="http://platform.twitter.com/widgets.js?ver=1.1"></script>
    <script>
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-10572636-6']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
</body>
</html>
