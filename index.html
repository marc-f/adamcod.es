<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">

    
        <title>words on code - adamcod.es</title>
    

    

    <meta name="author" content="Adam Brett">

    <!-- style -->
    <link rel="stylesheet" href="/css/style.css" type="text/css" media="screen, projection">

    <!-- RSS -->
    <link rel="alternate" type="application/rss+xml" href="http://feeds.feedburner.com/adamcodes/">

    <!-- fonts -->
    <link href="http://fonts.googleapis.com/css?family=Open+Sans:300,400" rel="stylesheet" type="text/css">
</head>
<body>
    <section class="layout-meta">
        <header>
            <p class="author vcard">
                <strong><a href="http://adamcod.es" rel="author">adamcod.es</a></strong><br />
                by <a href="http://adambrett.co.uk">Adam Brett</a>
            </p>
        </header>

        <nav>
            <ul>
                <!--li><a href="http://adambrett.co.uk/about">About</a></li-->
                <li><a href="/archive.html"><i class="icon-book"></i> Archive</a></li>
                <li><a href="http://feeds.feedburner.com/adamcodes/"><i class="icon-rss"></i> Subscribe</a></li>
                <li><a href="http://twitter.com/sixdaysad/"><i class="icon-twitter"></i> Contact</a></li>
            </ul>
        </nav>
    </section>

    <section class="layout-main">
        

<article>
    <div class="instapaper_ignore entry-unrelated">


    <h1 class="entry-title"><a href="http://adamcod.es/2013/08/27/one-thing-i-wish-i-knew-opscode-chef.html">The One Thing I Wish I Knew When Starting To Use Chef</a></h1>
    <p class="meta"><time pubdate class="published" datetime="2013-08-27">Tuesday, August 27, 2013</time></p>
    
    <a href="https://twitter.com/share" class="twitter-share-button" data-url="http://adamcod.es/2013/08/27/one-thing-i-wish-i-knew-opscode-chef.html" data-text="The One Thing I Wish I Knew When Starting To Use Chef by @sixdaysad">Tweet</a>
    

    </div>

    <div class="entry-content">
        <p>After a couple of months playing with chef, writing my own recipes, consuming, extending, and fixing bugs in other recipes, creating numerous cookbooks for use with vagrant, and even a couple I’ve used to provision servers, there is one thing I’ve picked up that I wish I’d known more than anything when I wrote <a href="/2013/01/15/vagrant-is-easy-chef-is-hard.html">Vagrant is easy - Chef is hard</a>.  Chef has a package manager.</p>

<h2 id="librarian-chef">Librarian-Chef</h2>

<p>You don’t need to use git sub-modules to manage your cookbooks.  Librarian is a general purpose package manager for creating other packages managers similar to composer for PHP and bundler for Ruby.  Librarian comes with librarian-chef out of the box (although they say it will be separated out at some point) and that allows you to use a <code>Cheffile</code> to manage your cookbook dependencies like so:</p>

<pre><code>cd /my/chef/project
echo /cookbooks &gt;&gt; .gitignore
echo /tmp &gt;&gt; .gitignore
librarian-chef init
</code></pre>

<p>You should now have a Cheffile at the root of your project.  You can then add cookbooks as dependencies and manage them with the commands <code>librarian-chef install</code> and <code>librarian-chef update</code>.  Librarian chef will create a lockfile, so use update and install <a href="/2013/03/07/composer-install-vs-composer-update.html">the same way as you would with composer</a>.</p>

<p>A basic Cheffile for one of my CentOS 6.4 Vagrant VMs looks like this:</p>

<div class="highlight"><pre><code class="ruby"><span class="c1">#!/usr/bin/env ruby</span>
<span class="c1">#^syntax detection</span>

<span class="n">site</span> <span class="s1">&#39;http://community.opscode.com/api/v1&#39;</span>

<span class="n">cookbook</span> <span class="s1">&#39;yum&#39;</span>
<span class="n">cookbook</span> <span class="s1">&#39;build-essential&#39;</span>
<span class="n">cookbook</span> <span class="s1">&#39;selinux&#39;</span>
<span class="n">cookbook</span> <span class="s1">&#39;iptables&#39;</span>
<span class="n">cookbook</span> <span class="s1">&#39;openssh&#39;</span>
<span class="n">cookbook</span> <span class="s1">&#39;openssl&#39;</span>
<span class="n">cookbook</span> <span class="s1">&#39;apache2&#39;</span>
<span class="n">cookbook</span> <span class="s1">&#39;php&#39;</span>
<span class="n">cookbook</span> <span class="s1">&#39;xdebug&#39;</span><span class="p">,</span>
    <span class="ss">:github</span> <span class="o">=&gt;</span> <span class="s1">&#39;xforty/chef-xdebug&#39;</span>
<span class="n">cookbook</span> <span class="s1">&#39;mysql&#39;</span>
<span class="n">cookbook</span> <span class="s1">&#39;database&#39;</span>
</code></pre></div>

<p>There is some redundancy built in here, as Librarian-chef will recursively resolve cookbook dependencies for you, which I think it does via <code>metadata.rb</code> (but don’t quote me on that).</p>

<p>The package names are the names of the packages as they appear on <a href="http://community.opscode.com">community.opscode.com</a>, and you can include 3rd party cookbooks from github like so:</p>

<pre><code>cookbook 'xdebug',
    :github =&gt; 'xforty/chef-xdebug'
</code></pre>

<p>Where <code>xforty/chef-xdebug</code> is <code>github-username/repo-name</code>.</p>

<p>With your Cheffile in the root of your project you can run:</p>

<pre><code>librarian-chef install
</code></pre>

<p>Which, much like <code>composer install</code> in the PHP world, and <code>bundle install</code> for Ruby, will go off to community.opscode.com and find the matching packages, and download them straight to the <code>./cookbooks</code> directory.</p>

<p>Similarly, <code>librarian-chef update</code> will update your cookbooks to the latest version and install any new ones you’ve added to your Cheffile.</p>

<p>To lock a cookbook to a specific version, specify it after the comma, like so:</p>

<pre><code>cookbook 'yum', 0.1.1
</code></pre>

<p>This will make sure whenever you run <code>librarian-chef install</code> or <code>librarian-chef update</code> you will always get the 0.1.1 version of the yum cookbook.</p>

<h2 id="read-next">Read Next</h2>

<ul>
  <li><a href="/2013/01/15/vagrant-is-easy-chef-is-hard.html">Vagrant is easy - Chef is hard</a></li>
</ul>

    </div>

    <section>
        <form class="well form-inline text-center" action="https://tinyletter.com/adambrett" method="post" target="popupwindow" onsubmit="window.open('https://tinyletter.com/adambrett', 'popupwindow', 'scrollbars=yes,width=800,height=600');return true">
    <p>For more exclusive content, including screen-casts, videos, and early beta access to my projects, subscribe to my email list below.</p>
    <p>
        <input type="text" name="email" placeholder="Enter your email address" /> <input type="submit" value="Subscribe" class="btn btn-primary" />
    </p>

    <input type="hidden" value="1" name="embed"/>
</form>

    </section>

    <hr>

    <footer>
        <p><small>I love discussion, but not blog comments.  If you want to comment on what's written above, head over to <a href="https://twitter.com/sixdaysad">twitter</a> or <a href="https://alpha.app.net/adambrett">ADN</a>.</small></p>
    </footer>
</article>


<hr>

<ul class="pager" />
    
    <li class="previous">
        <a href="/2013/08/09/take-note-code-connexx-2013.html">&larr; Previous</a>
    </li>
    
</ul>


        <footer>
            <p>Copyright &copy; 2012 <a href="http://adambrett.co.uk">Adam Brett</a>.  All rights reserved.</p>
        </footer>
    </section>

    <script>
        function setImageHeight() {
          var baseLine = 26, img, _i, _len, _ref, _results;
          _ref = document.getElementsByTagName('img');
          _results = [];
          for (_i = 0, _len = _ref.length; _i < _len; _i++) {
            img = _ref[_i];
            _results.push(img.style.height = Math.ceil(img.clientHeight / baseLine) * baseLine + "px");
            alert(img);
          }
          return _results;
        }

        if (window.addEventListener) {
          window.addEventListener('load', setImageHeight, false);
        } else if (window.attachEvent)  {
          window.attachEvent('onload', setImageHeight);
        }
    </script>
    <script src="http://platform.twitter.com/widgets.js?ver=1.1"></script>
    <script>
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-10572636-6']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
</body>
</html>
